<!DOCTYPE html>
<html lang="zh-Hant-TW">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="./CSS/all.css">
  <title>計算機</title>
  <style>
    /* 鎖住反白 */
    body {
      -webkit-user-select: none;
      -moz-user-select: none;
      -o-user-select: none;
      user-select: none;
      background: url('./images/background.jpg') fixed no-repeat center center/cover;
    }

    /* 設定 計算機 外觀樣式 */
    table {
      width: 150px;
      height: 240px;
      padding: 10px;
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: rgb(255, 255, 255);
      border-radius: 10px;
      box-shadow:
        3px 3px 7px rgba(0, 0, 0, 0.8);
    }

    /* 改變 按鈕區 滑鼠游標圖示 */
    tr:nth-child(4),
    tr:nth-child(5),
    tr:nth-child(6),
    tr:nth-child(7),
    tr:nth-child(8) {
      cursor: pointer;
    }

    /* 隱藏運算列 */
    tr:nth-child(1) {
      display: none;
    }

    /* 設定 運算列、紀錄列、答案列 樣式 */
    tr:nth-child(1) td,
    tr:nth-child(2) td,
    tr:nth-child(3) td {
      box-sizing: border-box;
      text-align: right;
      padding: 1px 2px;
      border-radius: 5px;
      background: rgb(245, 245, 245);
      /* border: 1px solid rgb(220, 220, 220); */
      box-shadow:
        0 0 0 rgba(0, 0, 0, .4),
        0 0 0 rgba(236, 236, 243, .9),
        inset -1px -1px 4px rgba(236, 236, 243, .9),
        inset 1px 1px 2px rgba(0, 0, 0, .4);
    }

    tr:nth-child(1) td,
    tr:nth-child(2) td {
      height: 15px;
      line-height: 12px;
      font-size: 0.5rem;
      color: gray;
    }

    tr:nth-child(3) td {
      height: 30px;
      line-height: 30px;
      color: gray;
    }

    /* 設定 按鈕 樣式 */
    tr:nth-child(4) td,
    tr:nth-child(5) td,
    tr:nth-child(6) td,
    tr:nth-child(7) td,
    tr:nth-child(8) td {
      box-sizing: border-box;
      width: 30px;
      height: 30px;
      text-align: center;
      line-height: 30px;
      border-radius: 5px;
      background: rgb(255, 255, 255);
      color: rgb(105, 105, 105);
      box-shadow:
        1px 1px 2px rgba(0, 0, 0, .4),
        -1px -1px 4px rgba(236, 236, 243, .9),
        inset 0 0 0 rgba(236, 236, 243, .9),
        inset 0 0 0 rgba(0, 0, 0, .4);
      transition: .1s;
    }

    /* 設定 按鈕 按下 樣式 */
    tr:nth-child(4) td:active,
    tr:nth-child(5) td:active,
    tr:nth-child(6) td:active,
    tr:nth-child(7) td:active,
    tr:nth-child(8) td:active {
      background: rgb(236, 236, 243);
      box-shadow:
        0 0 0 rgba(0, 0, 0, .4),
        0 0 0 rgba(236, 236, 243, .9),
        inset -1px -1px 4px rgba(236, 236, 243, .9),
        inset 1px 1px 2px rgba(0, 0, 0, .4);
    }

    /* 設定 × ÷ 按鈕 樣式*/
    tr:nth-child(4) td:nth-child(2),
    tr:nth-child(4) td:nth-child(3) {
      font-size: 1.2rem;
      padding-top: 0px;
      padding-bottom: 2px;
    }

    /* 設定 箭頭 按鈕 樣式 */
    tr:nth-child(4) td:nth-child(4) {
      font-size: .8rem;
      padding-top: 2px;
      padding-bottom: 0px;
    }
  </style>
</head>

<body>
  <table>
    <tr>
      <td id="math" colspan="4"></td>
    </tr>
    <tr>
      <td id="input" colspan="4"></td>
    </tr>
    <tr>
      <td id="answer" colspan="4">0</td>
    </tr>
    <tr>
      <td id="escape">C</td>
      <td id="divide">÷</td>
      <td id="multiply">×</td>
      <td id="backspace"><i class="fa-solid fa-arrow-left"></i></td>
    </tr>
    <tr>
      <td class="number">7</td>
      <td class="number">8</td>
      <td class="number">9</td>
      <td id="minus">-</td>
    </tr>
    <tr>
      <td class="number">4</td>
      <td class="number">5</td>
      <td class="number">6</td>
      <td id="plus">+</td>
    </tr>
    <tr>
      <td class="number">1</td>
      <td class="number">2</td>
      <td class="number">3</td>
      <td id="equals" rowspan="2">=</td>
    </tr>
    <tr>
      <td class="number" colspan="2">0</td>
      <td id="dot">.</td>
    </tr>
  </table>

  <script>
    // 抓取 運算列、顯示列、答案列
    const math = document.getElementById('math')
    const input = document.getElementById('input')
    const answer = document.getElementById('answer')
    // 抓取 功能鈕、運算鈕
    const escape = document.getElementById('escape')
    const backspace = document.getElementById('backspace')
    const equals = document.getElementById('equals')
    const plus = document.getElementById('plus')
    const minus = document.getElementById('minus')
    const multiply = document.getElementById('multiply')
    const divide = document.getElementById('divide')
    // 抓取 數字鈕、浮點鈕
    const numbers = document.querySelectorAll(".number")
    const dot = document.getElementById('dot')
    // let math = 0

    // 滑鼠事件
    /*
      按下 = 鍵
      （若 記錄列 沒有 ＝ 且 不為 空字串）
      => 記錄列：先 加上 ＝
      => 答案列：再 加總 運算列
      => 運算列：最後 同步 答案列
    */
    equals.onclick = () => {
      if (!input.innerText.includes('=') && input.innerText !== '') {
        input.innerText += '='
        // 處理浮點計算精度問題
        answer.innerText = parseFloat(eval(math.innerText).toPrecision(12))
        math.innerText = answer.innerText
      }
    }
    /*
      按下 C 鍵
      => 運算列：設為 空字串
      => 記錄列：設為 空字串
      => 答案列：設為 0
    */
    escape.onclick = () => {
      math.innerText = ''
      input.innerText = ''
      answer.innerText = '0'
    }
    /*
      按下 退位 鍵
      （ 若 記錄列 沒有 ＝）
      => 運算列：移除 最後一個字
      => 記錄列：移除 最後一個字
    */
    backspace.onclick = () => {
      if (!input.innerText.includes('=')) {
        math.innerText = math.innerText.substr(0, math.innerText.length - 1)
        input.innerText = input.innerText.substr(0, input.innerText.length - 1)
      }
    }
    /*
      按下 數字 鍵
      （若 記錄列 有 = ）
      => 運算列：等於 數字
      => 記錄列：等於 數字
      => 答案列：設為 0
      （又若 記錄列 為 空字串 ）
      => 運算列：等於 數字
      => 記錄列：等於 數字
      （又若 記錄列 為 其他狀況 ）
      => 運算列：加上 數字
      => 記錄列：加上 數字
    */
    for (const number of numbers) {
      number.onclick = () => {
        // console.log(number.innerText)
        if (input.innerText.includes('=')) {
          math.innerText = number.innerText
          input.innerText = number.innerText
          answer.innerText = 0
        } else if (input.innerText === '') {
          math.innerText = number.innerText
          input.innerText = number.innerText
        } else {
          math.innerText += number.innerText
          input.innerText += number.innerText
        }
      }
    }
    /*
      按下 . 鍵
      （若 記錄列 有 = ）
      => 運算列：設為 0.
      => 記錄列：設為 0.
      => 答案列：設為 0.
      （又若 記錄列 為 空字串 ）
      => 運算列：設為 0.
      => 記錄列：設為 0.
      （又若 記錄列 最後一字 不為 . ）
      => 運算列：加上 .
      => 記錄列：加上 .
    */
    dot.onclick = () => {
      if (input.innerText.includes('=')) {
        math.innerText = '0.'
        input.innerText = '0.'
        answer.innerText = '0.'
      } else if (input.innerText === '') {
        math.innerText = '0.'
        input.innerText = '0.'
      } else if (input.innerText.slice(-1) !== '.') {
        math.innerText += dot.innerText
        input.innerText += dot.innerText
      }
    }
    /*
      按下 + 鍵
      （若 記錄列 有 = ）
      => 記錄列：先 移除 =
      => 記錄列：再 同步 答案列
      （同時若 最後一字 不為 運算子 ）
      => 運算列：加上 +
      => 記錄列：加上 +
    */
    plus.onclick = () => {
      if (input.innerText.includes('=')) {
        input.innerText = input.innerText.substr(0, input.innerText.length - 1)
        input.innerText = answer.innerText
      }
      if (
        input.innerText.slice(-1) !== '+' &&
        input.innerText.slice(-1) !== '-' &&
        input.innerText.slice(-1) !== '×' &&
        input.innerText.slice(-1) !== '÷'
      ) {
        math.innerText += plus.innerText
        input.innerText += plus.innerText
      }
    }
    /*
      按下 - 鍵
      （若 記錄列 有 = ）
      => 記錄列：先 移除 =
      => 記錄列：再 同步 答案列
      （同時若 最後一字 不為 運算子 ）
      => 運算列：加上 -
      => 記錄列：加上 -
    */
    minus.onclick = () => {
      if (input.innerText.includes('=')) {
        input.innerText = input.innerText.substr(0, input.innerText.length - 1)
        input.innerText = answer.innerText
      }
      if (
        input.innerText.slice(-1) !== '+' &&
        input.innerText.slice(-1) !== '-' &&
        input.innerText.slice(-1) !== '×' &&
        input.innerText.slice(-1) !== '÷'
      ) {
        math.innerText += minus.innerText
        input.innerText += minus.innerText
      }
    }
    /*
      按下 × 鍵
      （若 記錄列 有 = ）
      => 記錄列：先 移除 =
      => 記錄列：再 同步 答案列
      （同時若 記錄列 最後一字 不為 運算子 ）
      => 運算列：加上 *
      => 記錄列：加上 ×
    */
    multiply.onclick = () => {
      if (input.innerText.includes('=')) {
        input.innerText = input.innerText.substr(0, input.innerText.length - 1)
        input.innerText = answer.innerText
      }
      if (
        input.innerText.slice(-1) !== '+' &&
        input.innerText.slice(-1) !== '-' &&
        input.innerText.slice(-1) !== '×' &&
        input.innerText.slice(-1) !== '÷'
      ) {
        math.innerText += '*'
        input.innerText += multiply.innerText
      }
    }
    /*
      按下 ÷ 鍵
      （若 記錄列 有 = ）
      => 記錄列：先 移除 =
      => 記錄列：再 同步 答案列
      （同時若 記錄列 最後一字 不為 運算子 ）
      => 運算列：加上 /
      => 記錄列：加上 ÷
    */
    divide.onclick = () => {
      if (input.innerText.includes('=')) {
        input.innerText = input.innerText.substr(0, input.innerText.length - 1)
        input.innerText = answer.innerText
      }
      if (
        input.innerText.slice(-1) !== '+' &&
        input.innerText.slice(-1) !== '-' &&
        input.innerText.slice(-1) !== '×' &&
        input.innerText.slice(-1) !== '÷'
      ) {
        math.innerText += '/'
        input.innerText += divide.innerText
      }
    }

    // 鍵盤事件
    document.onkeydown = event => {
      // escape.style.background = 'rgb(236, 236, 243)'
      // backspace.style.background = 'rgb(236, 236, 243)'
      // equals.style.background = 'rgb(236, 236, 243)'
      // plus.style.background = 'rgb(236, 236, 243)'
      // minus.style.background = 'rgb(236, 236, 243)'
      // multiply.style.background = 'rgb(236, 236, 243)'
      // divide.style.background = 'rgb(236, 236, 243)'
      // numbers.style.background = 'rgb(236, 236, 243)'
      // dot.style.background = 'rgb(236, 236, 243)'
      /*
        按下 Enter 鍵
        （ 若 記錄列 沒有 ＝ 且 不為 空字串）
        => 記錄列：先 加上 ＝
        => 答案列：再 加總 運算列
        => 運算列：最後 同步 答案列
      */
      if (event.key === 'Enter' && !input.innerText.includes('=') && input.innerText !== '') {
        input.innerText += '='
        // 處理浮點計算精度問題
        answer.innerText = parseFloat(eval(math.innerText).toPrecision(12))
        math.innerText = answer.innerText
      }
      /*
        按下 ESC 或 Delete 鍵
        => 運算列：設為 空字串
        => 記錄列：設為 空字串
        => 答案列：設為 0
      */
      else if (event.key === 'Escape' || event.key === 'Delete') {
        math.innerText = ''
        input.innerText = ''
        answer.innerText = '0'
      }
      /*
        按下 退位 鍵
        （ 若 記錄列 沒有 ＝）
        => 運算列：移除 最後一個字
        => 記錄列：移除 最後一個字
      */
      else if (event.key === 'Backspace' && !input.innerText.includes('=')) {
        math.innerText = math.innerText.substr(0, math.innerText.length - 1)
        input.innerText = input.innerText.substr(0, input.innerText.length - 1)
      }
      /*
        按下 數字 鍵
        （若 記錄列 有 = ）
        => 運算列：等於 數字
        => 記錄列：等於 數字
        => 答案列：設為 0
        （又若 記錄列 為 空字串 ）
        => 運算列：等於 數字
        => 記錄列：等於 數字
        （又若 記錄列 為 其他狀況 ）
        => 運算列：加上 數字
        => 記錄列：加上 數字
      */
      else if (!isNaN(parseInt(event.key))) {
        if (input.innerText.includes('=')) {
          math.innerText = event.key
          input.innerText = event.key
          answer.innerText = 0
        }
        else if (input.innerText === '') {
          math.innerText = event.key
          input.innerText = event.key
        } else {
          math.innerText += event.key
          input.innerText += event.key
        }
      }
      /*
        按下 . 鍵
        （若 記錄列 有 = ）
        => 運算列：設為 0.
        => 記錄列：設為 0.
        => 答案列：設為 0.
        （又若 記錄列 為 空字串 ）
        => 運算列：設為 0.
        => 記錄列：設為 0.
        （又若 記錄列 最後一字 不為 . ）
        => 運算列：加上 .
        => 記錄列：加上 .
      */
      else if (event.key === '.') {
        if (input.innerText.includes('=')) {
          math.innerText = '0.'
          input.innerText = '0.'
          answer.innerText = '0.'
        } else if (input.innerText === '') {
          math.innerText = '0.'
          input.innerText = '0.'
        } else if (input.innerText.slice(-1) !== '.') {
          math.innerText += event.key
          input.innerText += event.key
        }
      }
      /*
        按下 + - * / 鍵
        （若 記錄列 有 = ）
        => 記錄列：先 移除 =
        => 記錄列：再 同步 答案列
        （同時若 按下 * 鍵 且 記錄列 最後一字 不為 運算子 ）
        => 運算列：加上 *
        => 記錄列：加上 ×
          （或 按下 / 鍵 且 記錄列 最後一字 不為 運算子 ）
        ===> 運算列：加上 /
        ===> 記錄列：加上 ÷
          （或 按下 + - 鍵 且 記錄列 最後一字 不為 運算子 ）
        ===> 運算列：加上 運算子
        ===> 記錄列：加上 運算子
      */
      else if (
        event.key === '+' ||
        event.key === '-' ||
        event.key === '*' ||
        event.key === '/') {
        if (input.innerText.includes('=')) {
          input.innerText = input.innerText.substr(0, input.innerText.length - 1)
          input.innerText = answer.innerText
        }
        if (
          event.key === '*' &&
          input.innerText.slice(-1) !== '+' &&
          input.innerText.slice(-1) !== '-' &&
          input.innerText.slice(-1) !== '×' &&
          input.innerText.slice(-1) !== '÷'
        ) {
          math.innerText += event.key
          input.innerText += '×'
        } else if (
          event.key === '/' &&
          input.innerText.slice(-1) !== '+' &&
          input.innerText.slice(-1) !== '-' &&
          input.innerText.slice(-1) !== '×' &&
          input.innerText.slice(-1) !== '÷'
        ) {
          math.innerText += event.key
          input.innerText += '÷'
        } else if (
          input.innerText.slice(-1) !== '+' &&
          input.innerText.slice(-1) !== '-' &&
          input.innerText.slice(-1) !== '×' &&
          input.innerText.slice(-1) !== '÷'
        ) {
          math.innerText += event.key
          input.innerText += event.key
        }
      }
    }
  </script>
</body>

</html>